<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:materialIcons="clr-namespace:Material.Icons.WPF;assembly=Material.Icons.WPF"
                    xmlns:vwp="clr-namespace:WpfToolkit.Controls;assembly=VirtualizingWrapPanel">
    <ResourceDictionary.MergedDictionaries>
        <ResourceDictionary Source="/Themes/Colors.xaml"/>
        <ResourceDictionary Source="/Themes/Converters.xaml"/>
    </ResourceDictionary.MergedDictionaries>

    <!-- #region FILE EXPLORER GRID MODE STYLES -->

    <!-- 1. Master ListBox Style: The Virtualization Engine -->
    <Style x:Key="ModernFileGridListBoxStyle" TargetType="ListBox">
        <Setter Property="Background" Value="Transparent"/>
        <Setter Property="BorderThickness" Value="0"/>
        <Setter Property="SelectionMode" Value="Extended"/>
        <Setter Property="Padding" Value="0,5,0,0"/>
        <Setter Property="ScrollViewer.HorizontalScrollBarVisibility" Value="Disabled"/>
        
        <!-- Core Virtualization Settings -->
        <Setter Property="VirtualizingPanel.IsVirtualizing" Value="True"/>
        <Setter Property="VirtualizingPanel.VirtualizationMode" Value="Recycling"/>
        <Setter Property="VirtualizingPanel.CacheLength" Value="2,2"/>
        <Setter Property="VirtualizingPanel.CacheLengthUnit" Value="Page"/>
        <Setter Property="ScrollViewer.CanContentScroll" Value="True"/>
        
        <Setter Property="ItemsPanel">
            <Setter.Value>
                <ItemsPanelTemplate>
                    <vwp:VirtualizingWrapPanel Orientation="Horizontal" 
                                               SpacingMode="Uniform" 
                                               ScrollUnit="Pixel"/>
                </ItemsPanelTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- 2. Individual Card Container Style -->
    <Style x:Key="FileGridItemStyle" TargetType="ListBoxItem">
        <Setter Property="Background" Value="Transparent"/>
        <Setter Property="BorderThickness" Value="0"/>
        <Setter Property="Padding" Value="0"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="ListBoxItem">
                    <ContentPresenter />
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- 3. The Visual Card Design (Template) -->
    <DataTemplate x:Key="FileGridItemTemplate">
        <Border Margin="6" Width="130" Height="160" CornerRadius="10"
                Background="{StaticResource CardBackground}"
                BorderBrush="{StaticResource BorderColor}" BorderThickness="1">
            <Border.Style>
                <Style TargetType="Border">
                    <Style.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter Property="BorderBrush" Value="{StaticResource AccentBrush}"/>
                            <Setter Property="Background" Value="{StaticResource HoverColor}"/>
                        </Trigger>
                    </Style.Triggers>
                </Style>
            </Border.Style>

            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Thumbnail Area -->
                <Border Grid.Row="0" CornerRadius="9,9,0,0" Background="{StaticResource SidebarBackground}" Opacity="0.5">
                    <Grid>
                        <!-- Placeholder/Loading Icon -->
                        <materialIcons:MaterialIcon Kind="{Binding Node, Converter={StaticResource PathToIconConverter}}" 
                                                    Width="48" Height="48" Foreground="{StaticResource TextMuted}"
                                                    RenderTransformOrigin="0.5,0.5"
                                                    Visibility="{Binding ImagePreview, Converter={StaticResource NullToVisibilityConverter}, ConverterParameter=Invert}">
                            <materialIcons:MaterialIcon.RenderTransform>
                                <RotateTransform Angle="0"/>
                            </materialIcons:MaterialIcon.RenderTransform>
                            <materialIcons:MaterialIcon.Style>
                                <Style TargetType="materialIcons:MaterialIcon">
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding Node.Name}" Value="Loading...">
                                            <DataTrigger.EnterActions>
                                                <BeginStoryboard Storyboard="{StaticResource SpinningIconAnimation}"/>
                                            </DataTrigger.EnterActions>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </materialIcons:MaterialIcon.Style>
                        </materialIcons:MaterialIcon>

                        <!-- Real Image Preview -->
                        <Border CornerRadius="9,9,0,0" Visibility="{Binding ImagePreview, Converter={StaticResource NullToVisibilityConverter}}">
                            <Border.Background>
                                <ImageBrush ImageSource="{Binding ImagePreview}" Stretch="UniformToFill"/>
                            </Border.Background>
                        </Border>

                        <!-- Top Type Badge -->
                        <Border HorizontalAlignment="Right" VerticalAlignment="Top" Margin="6" 
                                Background="#CC000000" CornerRadius="3" Padding="4,1">
                            <TextBlock Text="{Binding FileExtensionDisplay}" FontSize="8" FontWeight="Black" Foreground="White"/>
                        </Border>
                    </Grid>
                </Border>

                <!-- Label Area -->
                <Border Grid.Row="1" Padding="8,4,8,8">
                    <StackPanel HorizontalAlignment="Center">
                        <TextBlock Text="{Binding DisplayNameShort}" FontSize="11" FontWeight="SemiBold" 
                                   Foreground="{StaticResource TextPrimary}" TextTrimming="CharacterEllipsis" 
                                   TextWrapping="Wrap" Height="36" LineHeight="14"
                                   TextAlignment="Center" HorizontalAlignment="Center"/>

                        <!-- Small indicators -->
                        <StackPanel Orientation="Horizontal" Visibility="{Binding IsFolder, Converter={StaticResource BooleanToVisibilityConverter}}" Margin="0,4,0,0" HorizontalAlignment="Center">
                            <StackPanel Orientation="Horizontal" Visibility="{Binding FolderCount, Converter={StaticResource CountToVisibilityConverter}}" Margin="0,0,8,0">
                                <materialIcons:MaterialIcon Kind="FolderOutline" Width="10" Height="10" Foreground="{StaticResource AccentOrange}" Margin="0,0,3,0" VerticalAlignment="Center"/>
                                <TextBlock Text="{Binding FolderCount}" FontSize="9" Foreground="{StaticResource TextSecondary}" VerticalAlignment="Center"/>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Visibility="{Binding AssetCount, Converter={StaticResource CountToVisibilityConverter}}">
                                <materialIcons:MaterialIcon Kind="CubeOutline" Width="10" Height="10" Foreground="{StaticResource AccentGreen}" Margin="0,0,3,0" VerticalAlignment="Center"/>
                                <TextBlock Text="{Binding AssetCount}" FontSize="9" Foreground="{StaticResource TextSecondary}" VerticalAlignment="Center"/>
                            </StackPanel>
                        </StackPanel>
                    </StackPanel>
                </Border>

                <!-- Selection Overlay (On Top) -->
                <Border Grid.RowSpan="2" BorderThickness="2" CornerRadius="10" 
                        BorderBrush="{StaticResource AccentBrush}" IsHitTestVisible="False"
                        Visibility="{Binding IsSelected, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                <materialIcons:MaterialIcon Grid.RowSpan="2" Kind="CheckCircle" Foreground="{StaticResource AccentBrush}" 
                                            Width="18" Height="18" HorizontalAlignment="Right" VerticalAlignment="Bottom" 
                                            Margin="0,0,12,12" 
                                            Visibility="{Binding IsSelected, Converter={StaticResource BooleanToVisibilityConverter}}"/>
            </Grid>
        </Border>
    </DataTemplate>

    <!-- #endregion -->

    <!-- Estilo para las filas -->
    <Style x:Key="ModernListViewItem" TargetType="ListViewItem">
        <Setter Property="ClipToBounds" Value="True"/>
        <Setter Property="Background" Value="Transparent"/>
        <Setter Property="BorderThickness" Value="0,0,0,1"/>
        <Setter Property="BorderBrush" Value="{StaticResource BorderColor}"/>
        <Setter Property="Padding" Value="16,1"/>
        <Setter Property="MinHeight" Value="28"/>
        <Setter Property="Margin" Value="0"/>
        <Setter Property="VerticalContentAlignment" Value="Center"/>
        <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="ListViewItem">
                    <Border Background="{TemplateBinding Background}"
                            BorderBrush="{TemplateBinding BorderBrush}"
                            BorderThickness="{TemplateBinding BorderThickness}"
                            Padding="{TemplateBinding Padding}">
                        <ContentPresenter VerticalAlignment="{TemplateBinding VerticalContentAlignment}" />
                    </Border>
                    <ControlTemplate.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter Property="Background" Value="{StaticResource CardBackground}"/>
                        </Trigger>
                        <Trigger Property="IsSelected" Value="True">
                            <Setter Property="Background" Value="{StaticResource AccentBrush}"/>
                            <Setter Property="Foreground" Value="White"/>
                            <Setter Property="BorderBrush" Value="{StaticResource AccentBrush}"/>
                        </Trigger>
                        <MultiTrigger>
                            <MultiTrigger.Conditions>
                                <Condition Property="IsSelected" Value="True"/>
                                <Condition Property="IsMouseOver" Value="True"/>
                            </MultiTrigger.Conditions>
                            <Setter Property="Background" Value="{StaticResource AccentBrush}"/>
                            <Setter Property="Foreground" Value="White"/>
                        </MultiTrigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- Estilo moderno para el ListView -->
    <Style x:Key="ModernListView" TargetType="ListView">
        <Setter Property="Background" Value="{StaticResource SidebarBackground}"/>
        <Setter Property="BorderBrush" Value="Transparent"/>
        <Setter Property="BorderThickness" Value="0"/>
        <Setter Property="ScrollViewer.HorizontalScrollBarVisibility" Value="Disabled"/>
        <Setter Property="ScrollViewer.VerticalScrollBarVisibility" Value="Disabled"/>
        <Setter Property="Padding" Value="0"/>
        <Setter Property="ItemContainerStyle" Value="{StaticResource ModernListViewItem}"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="ListView">
                    <Border BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" Background="{TemplateBinding Background}" Padding="{TemplateBinding Padding}" SnapsToDevicePixels="true">
                        <ItemsPresenter SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"/>
                    </Border>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- Estilo para tipo Models/Paneles Seleccioanables (Models) -->
    <Style x:Key="ListBoxItemStyle" TargetType="ListBoxItem">
        <Setter Property="HorizontalAlignment" Value="Stretch"/>
        <Setter Property="Padding" Value="2"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="ListBoxItem">
                    <Border x:Name="Border"
                            Background="{TemplateBinding Background}">
                        <ContentPresenter/>
                    </Border>
                    <ControlTemplate.Triggers>
                        <Trigger Property="IsSelected" Value="True">
                            <Setter TargetName="Border" Property="Background" Value="{StaticResource CardBackground}"/>
                            <Setter Property="Foreground" Value="White"/>
                        </Trigger>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter TargetName="Border" Property="Background" Value="{StaticResource CardBackground}"/>
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- Estilo para ListBox con Scroll Suave y apariencia unificada. Utilizado para la lista de modelos y la lista de animaciones. -->
    <Style x:Key="SmoothScrollListBox" TargetType="ListBox">
        <Setter Property="Background" Value="{StaticResource SidebarBackground}"/>
        <Setter Property="BorderThickness" Value="0"/>
        <Setter Property="ScrollViewer.CanContentScroll" Value="False"/>
        <Setter Property="ItemContainerStyle" Value="{StaticResource ListBoxItemStyle}"/>
    </Style>

    <!-- ESTILO MAESTRO PARA TARJETAS SELECCIONABLES (Usado en Models, Animations e Image Merger) -->
    <Style x:Key="ModernSelectableCardItemStyle" TargetType="ListBoxItem">
        <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
        <Setter Property="Background" Value="Transparent"/>
        <Setter Property="Padding" Value="0"/>
        <Setter Property="Margin" Value="0,0,0,8"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="ListBoxItem">
                    <Grid x:Name="RootGrid" SnapsToDevicePixels="True">
                        <!-- 1. Background Layer -->
                        <Border x:Name="BackgroundBorder" Background="{StaticResource CardBackground}" CornerRadius="8"/>

                        <!-- 2. Content Layer -->
                        <Grid Margin="1">
                            <Grid Margin="12,8">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <ContentPresenter Grid.Column="0" />
                                <materialIcons:MaterialIcon x:Name="CheckIcon" Grid.Column="1" Kind="CheckCircle" Foreground="{StaticResource AccentBrush}" Width="18" Height="18" Margin="8,0,0,0" Visibility="Hidden"/>
                            </Grid>
                        </Grid>

                        <!-- 3. Border Overlay -->
                        <Border x:Name="SelectionBorder" 
                                BorderBrush="{StaticResource BorderColor}" 
                                BorderThickness="1" 
                                CornerRadius="8" 
                                IsHitTestVisible="False"/>
                    </Grid>
                    <ControlTemplate.Triggers>
                        <Trigger Property="IsSelected" Value="True">
                            <Setter TargetName="SelectionBorder" Property="BorderBrush" Value="{StaticResource AccentBrush}"/>
                            <Setter TargetName="SelectionBorder" Property="BorderThickness" Value="1.5"/>
                            <Setter TargetName="BackgroundBorder" Property="Background" Value="{StaticResource HoverColor}"/>
                            <Setter TargetName="CheckIcon" Property="Visibility" Value="Visible"/>
                        </Trigger>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter TargetName="BackgroundBorder" Property="Background" Value="{StaticResource HoverColor}"/>
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

</ResourceDictionary>
