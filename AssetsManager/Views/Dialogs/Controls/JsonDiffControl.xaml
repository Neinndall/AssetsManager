<UserControl x:Class="AssetsManager.Views.Dialogs.Controls.JsonDiffControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:AssetsManager.Views.Dialogs.Controls"
             xmlns:avalonEdit="http://icsharpcode.net/sharpdevelop/avalonedit"
             xmlns:icons="clr-namespace:Material.Icons.WPF;assembly=Material.Icons.WPF"
             xmlns:jsonDiff="clr-namespace:AssetsManager.Views.Dialogs.Controls"
             mc:Ignorable="d" Background="{StaticResource SidebarBackground}">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header Section -->
        <Border Grid.Row="0"
                Background="{StaticResource CardBackground}"
                BorderBrush="{StaticResource BorderColor}"
                BorderThickness="0,0,0,1"
                Padding="24,20">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                    <Border Background="{StaticResource HoverColor}" CornerRadius="10" Width="48" Height="48" Margin="0,0,16,0">
                        <icons:MaterialIcon Kind="FileDocumentEditOutline" Width="24" Height="24" Foreground="{StaticResource AccentBrush}" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                    </Border>
                    <StackPanel VerticalAlignment="Center">
                        <TextBlock Text="Text Comparison" 
                                   FontSize="20" 
                                   FontWeight="Bold"
                                   Foreground="{StaticResource TextPrimary}"/>
                        <TextBlock Text="Analyze differences between file versions" 
                                   FontSize="13" 
                                   Foreground="{StaticResource TextSecondary}"
                                   Margin="0,2,0,0"/>
                    </StackPanel>
                </StackPanel>

                <!-- TOOLBAR AREA -->
                <Border Grid.Column="1" 
                        Background="{StaticResource SidebarBackground}"
                        BorderBrush="{StaticResource BorderColor}"
                        BorderThickness="1"
                        CornerRadius="8"
                        Padding="6"
                        VerticalAlignment="Center">
                    <StackPanel Orientation="Horizontal">
                        <!-- Navigation Group -->
                        <Button x:Name="PreviousDiffButton" 
                                Click="PreviousDiffButton_Click" 
                                Style="{StaticResource TransparentIconButton}"
                                Width="34" Height="34"
                                ToolTip="Previous Difference">
                             <icons:MaterialIcon Kind="ChevronUp" Width="20" Height="20"/>
                        </Button>
                        <Button x:Name="NextDiffButton" 
                                Click="NextDiffButton_Click" 
                                Style="{StaticResource TransparentIconButton}"
                                Width="34" Height="34"
                                ToolTip="Next Difference">
                             <icons:MaterialIcon Kind="ChevronDown" Width="20" Height="20"/>
                        </Button>

                        <Border Background="{StaticResource BorderColor}" Width="1" Margin="8,4" CornerRadius="1"/>

                        <!-- Settings Group -->
                        <ToggleButton x:Name="WordWrapButton"
                                      Click="WordWrapButton_Click"
                                      Style="{StaticResource TransparentIconToggleButton}"
                                      Width="34" Height="34"
                                      ToolTip="Toggle Word Wrap">
                             <icons:MaterialIcon Kind="Wrap" Width="18" Height="18"/>
                        </ToggleButton>
                        <ToggleButton x:Name="WordLevelDiffButton"
                                      Margin="4,0,0,0"
                                      Click="WordLevelDiffButton_Click"
                                      Style="{StaticResource TransparentIconToggleButton}"
                                      Width="34" Height="34"
                                      ToolTip="Toggle Word-Level Diff">
                             <icons:MaterialIcon Kind="FormatText" Width="18" Height="18"/>
                        </ToggleButton>
                        <ToggleButton x:Name="HideUnchangedButton"
                                      Margin="4,0,0,0"
                                      Click="HideUnchangedButton_Click"
                                      Style="{StaticResource TransparentIconToggleButton}"
                                      Width="34" Height="34"
                                      ToolTip="Show/Hide Unchanged Lines">
                             <icons:MaterialIcon Kind="FilterVariant" Width="18" Height="18"/>
                        </ToggleButton>
                    </StackPanel>
                </Border>
            </Grid>
        </Border>

        <!-- Main Content -->
        <Grid Grid.Row="1" Margin="24">
            <!-- Diff Grid -->
            <Grid x:Name="DiffGrid" Visibility="Collapsed">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="64"/>
                </Grid.ColumnDefinitions>

                <!-- Old JSON Card -->
                <Border Grid.Column="0" Style="{StaticResource SettingsCard}" Padding="0" Background="Transparent">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- Sub-Header: OLD VERSION -->
                        <Border Grid.Row="0" Background="{StaticResource SidebarBackground}" CornerRadius="12,12,0,0" BorderBrush="{StaticResource BorderColor}" BorderThickness="0,0,0,1">
                            <Border Padding="12,12,12,10">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <Border Background="#1AFF9100" CornerRadius="8" Width="34" Height="34" Margin="0,0,12,0">
                                        <icons:MaterialIcon Kind="History" Width="18" Height="18" Foreground="{StaticResource AccentOrange}"/>
                                    </Border>
                                    
                                    <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                                                                    <TextBlock Text="OLD VERSION" FontSize="10" FontWeight="Black" Foreground="{StaticResource AccentOrange}" Opacity="0.8"/>                                        <TextBlock x:Name="OldFileNameLabel" FontSize="11" FontWeight="SemiBold" Foreground="{StaticResource TextPrimary}" Margin="0,1,0,0" TextTrimming="CharacterEllipsis"/>
                                    </StackPanel>
                                </Grid>
                            </Border>
                        </Border>

                        <Border Grid.Row="1" Padding="0" Background="{StaticResource DarkBackground}" CornerRadius="0,0,12,12">
                            <avalonEdit:TextEditor x:Name="OldJsonContent" Style="{StaticResource BaseTextEditorStyle}"/>
                        </Border>
                    </Grid>
                </Border>

                <GridSplitter Grid.Column="1" Width="12" HorizontalAlignment="Center" VerticalAlignment="Stretch" Background="Transparent"/>

                <!-- New JSON Card -->
                <Border Grid.Column="2" Style="{StaticResource SettingsCard}" Padding="0" Background="Transparent">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- Sub-Header: NEW VERSION -->
                        <Border Grid.Row="0" Background="{StaticResource SidebarBackground}" CornerRadius="12,12,0,0" BorderBrush="{StaticResource BorderColor}" BorderThickness="0,0,0,1">
                            <Border Padding="12,12,12,10">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <Border Background="#1A00E676" CornerRadius="8" Width="34" Height="34" Margin="0,0,12,0">
                                        <icons:MaterialIcon Kind="FlashOutline" Width="18" Height="18" Foreground="{StaticResource AccentGreen}"/>
                                    </Border>
                                    
                                    <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                                                                    <TextBlock Text="NEW VERSION" FontSize="10" FontWeight="Black" Foreground="{StaticResource AccentGreen}" Opacity="0.8"/>                                        <TextBlock x:Name="NewFileNameLabel" FontSize="11" FontWeight="SemiBold" Foreground="{StaticResource TextPrimary}" Margin="0,1,0,0" TextTrimming="CharacterEllipsis"/>
                                    </StackPanel>
                                </Grid>
                            </Border>
                        </Border>

                        <Border Grid.Row="1" Padding="0" Background="{StaticResource DarkBackground}" CornerRadius="0,0,12,12">
                            <avalonEdit:TextEditor x:Name="NewJsonContent" Style="{StaticResource BaseTextEditorStyle}"/>
                        </Border>
                    </Grid>
                </Border>

                <GridSplitter Grid.Column="3" Width="12" HorizontalAlignment="Center" VerticalAlignment="Stretch" Background="Transparent"/>

                <!-- Navigation Panel Card -->
                <Border Grid.Column="4" Style="{StaticResource SettingsCard}" Padding="0" Background="Transparent">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        
                        <!-- Sub-Header: MAP -->
                        <Border Grid.Row="0" Background="{StaticResource SidebarBackground}" CornerRadius="12,12,0,0" BorderBrush="{StaticResource BorderColor}" BorderThickness="0,0,0,1">
                            <Border Padding="8,10">
                                <icons:MaterialIcon Kind="MapOutline" Width="18" Height="18" Foreground="{StaticResource TextMuted}"/>
                            </Border>
                        </Border>
                        
                        <Border Grid.Row="1" Background="{StaticResource DarkBackground}" CornerRadius="0,0,12,12">
                            <jsonDiff:DiffNavigationPanel x:Name="DiffNavigationPanel" Margin="0,4"/>
                        </Border>
                    </Grid>
                </Border>
            </Grid>
        </Grid>
    </Grid>
</UserControl>
