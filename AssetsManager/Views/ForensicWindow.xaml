<UserControl x:Class="AssetsManager.Views.ForensicWindow"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:materialIcons="clr-namespace:Material.Icons.WPF;assembly=Material.Icons.WPF"
             mc:Ignorable="d" 
             d:DesignHeight="730" d:DesignWidth="1100">

    <Grid Margin="32,24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/> <!-- Header -->
            <RowDefinition Height="Auto"/> <!-- Control Deck -->
            <RowDefinition Height="*"/>    <!-- Main Console -->
            <RowDefinition Height="Auto"/> <!-- Footer -->
        </Grid.RowDefinitions>

        <!-- 1. Unified Monitor Header -->
        <Border Grid.Row="0" BorderBrush="{StaticResource BorderColor}" BorderThickness="0,0,0,1" Padding="0,0,0,20" Margin="0,0,0,24">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                
                <!-- Icon & Title -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                    <Border Width="48" Height="48" CornerRadius="12" Background="{StaticResource CardBackground}" BorderBrush="{StaticResource BorderColor}" BorderThickness="1">
                        <materialIcons:MaterialIcon Kind="Fingerprint" Width="24" Height="24" Foreground="{StaticResource AccentPurple}" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    </Border>
                    <StackPanel VerticalAlignment="Center" Margin="16,0,0,0">
                        <TextBlock Text="MONITOR HASH FORENSIC" FontSize="20" FontWeight="Black" Foreground="White"/>
                        <TextBlock Text="ADVANCED PBE DISCOVERY LAB" FontSize="11" Foreground="{StaticResource TextSecondary}" FontWeight="Medium" Opacity="0.7"/>
                    </StackPanel>
                </StackPanel>

                <!-- Watermark / Decor -->
                <materialIcons:MaterialIcon Grid.Column="1" Kind="Radar" Width="120" Height="120" Foreground="{StaticResource TextMuted}" Opacity="0.05" HorizontalAlignment="Right" VerticalAlignment="Center" Margin="0,-20,-20,-20"/>
            </Grid>
        </Border>

        <!-- 2. Control Deck (Actions) -->
        <Grid Grid.Row="1" Margin="0,0,0,16">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- Harvest Action -->
            <Button Grid.Column="0" Click="Harvest_Click" Style="{StaticResource PrimaryButton}" Height="40" Padding="20,0" Margin="0,0,12,0">
                <StackPanel Orientation="Horizontal">
                    <materialIcons:MaterialIcon Kind="ArchiveArrowDownOutline" Width="16" Height="16" Margin="0,0,8,0"/>
                    <TextBlock Text="HARVEST UNKNOWNS" FontWeight="Bold" FontSize="11"/>
                </StackPanel>
            </Button>

            <!-- Engine Action -->
            <Button Grid.Column="1" x:Name="GuessButton" Click="Guess_Click" Style="{StaticResource SecondaryButton}" Height="40" Padding="20,0" IsEnabled="False">
                <StackPanel Orientation="Horizontal">
                    <materialIcons:MaterialIcon Kind="AutoFix" Width="16" Height="16" Margin="0,0,8,0"/>
                    <TextBlock Text="LAUNCH GUESS ENGINE" FontWeight="Bold" FontSize="11"/>
                </StackPanel>
            </Button>

            <!-- Stats Display -->
            <Border Grid.Column="3" Background="{StaticResource CardBackground}" CornerRadius="6" BorderBrush="{StaticResource BorderColor}" BorderThickness="1" Padding="16,0">
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock Text="DATABASE STATUS:" FontSize="10" Foreground="{StaticResource TextMuted}" FontWeight="Bold" VerticalAlignment="Center" Margin="0,0,8,0"/>
                    <TextBlock x:Name="OperationsSummaryText" Text="| CHECKING..." FontSize="11" Foreground="{StaticResource AccentBlue}" FontWeight="Bold" VerticalAlignment="Center"/>
                </StackPanel>
            </Border>
        </Grid>

        <!-- 3. Full Screen Discovery Console -->
        <Border Grid.Row="2" Background="{StaticResource CardBackground}" CornerRadius="12" BorderBrush="{StaticResource BorderColor}" BorderThickness="1">
            <Grid>
                <!-- Empty State -->
                <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center" Opacity="0.1" IsHitTestVisible="False">
                    <materialIcons:MaterialIcon Kind="ConsoleNetwork" Width="80" Height="80" Foreground="White"/>
                    <TextBlock Text="WAITING FOR TARGETS" HorizontalAlignment="Center" FontWeight="Bold" Margin="0,16,0,0" FontSize="14"/>
                </StackPanel>

                <!-- List Content -->
                <ListBox x:Name="DiscoveryList" Background="Transparent" BorderThickness="0" Padding="8">
                    <ListBox.ItemContainerStyle>
                        <Style TargetType="ListBoxItem">
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="ListBoxItem">
                                        <Border x:Name="ItemBorder" Background="Transparent" CornerRadius="4" Margin="0,1" Padding="12,8">
                                            <ContentPresenter/>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter TargetName="ItemBorder" Property="Background" Value="{StaticResource HoverColor}"/>
                                            </Trigger>
                                            <Trigger Property="IsSelected" Value="True">
                                                <Setter TargetName="ItemBorder" Property="Background" Value="{StaticResource HoverColor}"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </ListBox.ItemContainerStyle>
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="140"/> <!-- Hash -->
                                    <ColumnDefinition Width="*"/>   <!-- Path -->
                                    <ColumnDefinition Width="Auto"/> <!-- Badges -->
                                </Grid.ColumnDefinitions>

                                <!-- 1. Technical ID -->
                                <StackPanel Grid.Column="0" VerticalAlignment="Center">
                                    <TextBlock Text="HASH_ID" FontSize="8" Foreground="{StaticResource TextMuted}" FontWeight="Bold" Opacity="0.5"/>
                                    <TextBlock Text="{Binding Hash, StringFormat=x16}" FontFamily="Consolas" FontSize="12" Foreground="{StaticResource TextSecondary}"/>
                                </StackPanel>

                                <!-- 2. Discovered Path -->
                                <TextBlock Grid.Column="1" Text="{Binding Name}" Foreground="{StaticResource AccentGreen}" FontSize="13" FontWeight="SemiBold" VerticalAlignment="Center" TextTrimming="CharacterEllipsis" Margin="12,0"/>

                                <!-- 3. Source & Meta -->
                                <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                                    <Border Background="{StaticResource SidebarBackground}" CornerRadius="4" Padding="8,4" Margin="0,0,8,0" BorderBrush="{StaticResource BorderColor}" BorderThickness="1">
                                        <StackPanel>
                                            <TextBlock Text="SOURCE" FontSize="7" Foreground="{StaticResource TextMuted}" FontWeight="Bold" HorizontalAlignment="Center"/>
                                            <TextBlock Text="{Binding SourceWad}" FontSize="9" Foreground="White" HorizontalAlignment="Center"/>
                                        </StackPanel>
                                    </Border>
                                    <Border Background="{StaticResource SidebarBackground}" CornerRadius="4" Padding="8,4" BorderBrush="{StaticResource AccentPurple}" BorderThickness="1" Opacity="0.8">
                                        <StackPanel>
                                            <TextBlock Text="METHOD" FontSize="7" Foreground="{StaticResource AccentPurple}" FontWeight="Bold" HorizontalAlignment="Center"/>
                                            <TextBlock Text="{Binding Method}" FontSize="9" Foreground="White" HorizontalAlignment="Center" FontWeight="Bold"/>
                                        </StackPanel>
                                    </Border>
                                </StackPanel>
                            </Grid>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>

                <!-- Loading Overlay -->
                <Border x:Name="LoadingOverlay" Background="{StaticResource SidebarBackground}" Opacity="0.95" Visibility="Collapsed" CornerRadius="12">
                    <StackPanel VerticalAlignment="Center">
                        <materialIcons:MaterialIcon Kind="Radioactive" Width="48" Height="48" Style="{StaticResource SpinningIconStyle}" Foreground="{StaticResource AccentPurple}"/>
                        <TextBlock x:Name="DetailedLoadingText" Text="INITIALIZING FORENSIC ENGINE..." HorizontalAlignment="Center" Foreground="White" FontWeight="Bold" Margin="0,20,0,0" FontSize="12"/>
                        <TextBlock x:Name="StatusText" Text="Please wait while the system processes cluster data." HorizontalAlignment="Center" Foreground="{StaticResource TextSecondary}" FontSize="11" Margin="0,8,0,0"/>
                    </StackPanel>
                </Border>
            </Grid>
        </Border>

        <!-- 4. Footer Status Bar -->
        <Border Grid.Row="3" Background="{StaticResource SidebarBackground}" BorderBrush="{StaticResource BorderColor}" BorderThickness="1" CornerRadius="8" Padding="12,0" Margin="0,12,0,0" Height="32">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                <materialIcons:MaterialIcon x:Name="StatusIcon" Kind="InformationOutline" Width="14" Height="14" Foreground="{StaticResource AccentBlue}" VerticalAlignment="Center"/>
                <TextBlock Text="Ready for Operation" Foreground="{StaticResource TextSecondary}" FontSize="11" VerticalAlignment="Center" Margin="10,0,0,0" FontWeight="Medium"/>
            </StackPanel>
        </Border>
    </Grid>
</UserControl>