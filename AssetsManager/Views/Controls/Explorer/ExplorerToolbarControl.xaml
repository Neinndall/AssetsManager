<UserControl x:Class="AssetsManager.Views.Controls.Explorer.ExplorerToolbarControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:materialIcons="clr-namespace:Material.Icons.WPF;assembly=Material.Icons.WPF"
             mc:Ignorable="d">
    <Grid DataContext="{Binding Toolbar}">
        <Border Background="{StaticResource CardBackground}" 
                CornerRadius="6" 
                Padding="4" 
                BorderBrush="{StaticResource BorderColor}" 
                BorderThickness="1"
                HorizontalAlignment="Left">
            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                
                <!-- Toggle Tools Button (Hamburger) -->
                <ToggleButton x:Name="ToolsToggleButton" 
                              Style="{StaticResource TransparentIconToggleButton}" 
                              IsChecked="{Binding IsToolsExpanded}"
                              ToolTip="Show/Hide Tools"
                              Margin="0,0,4,0">
                    <materialIcons:MaterialIcon Kind="{Binding IsToolsExpanded, Converter={StaticResource BooleanToMaterialIconConverter}, ConverterParameter='MenuOpen,Menu'}" Width="18" Height="18"/>
                </ToggleButton>

                <!-- Action Group (Collapsable Tools) -->
                <StackPanel x:Name="ToolsPanel" Orientation="Horizontal" Visibility="{Binding IsToolsExpanded, Converter={StaticResource BoolToVisibilityConverter}}">
                    <Button x:Name="CollapseToContainerButton" 
                            Style="{StaticResource TransparentIconButton}" 
                            ToolTip="Collapse all folders" 
                            Margin="0,0,2,0" 
                            Click="CollapseToContainerButton_Click">
                        <materialIcons:MaterialIcon Kind="ArrowCollapseAll" Width="18" Height="18"/>
                    </Button>
                    <Button x:Name="LoadComparisonButton" 
                            Style="{StaticResource TransparentIconButton}" 
                            ToolTip="Load Comparison Backup" 
                            Margin="0,0,2,0" 
                            Click="LoadComparisonButton_Click">
                        <materialIcons:MaterialIcon Kind="FileUpload" Width="18" Height="18"/>
                    </Button>
                    <ToggleButton x:Name="SortToggleButton"
                                  Style="{StaticResource TransparentIconToggleButton}"
                                  Click="SortToggleButton_Click"
                                  ToolTip="Group by paths/categories"
                                  Margin="0,0,2,0"
                                  IsChecked="True"
                                  Visibility="{Binding IsSortButtonVisible, Converter={StaticResource BoolToVisibilityConverter}}">
                        <materialIcons:MaterialIcon Kind="SortAlphabeticalAscending" Width="18" Height="18"/>
                    </ToggleButton>
                    
                    <Rectangle Width="1" Height="16" Fill="{StaticResource BorderColor}" Margin="4,0,8,0" VerticalAlignment="Center"/>
                    
                    <Button x:Name="SwitchModeButton" 
                            Style="{StaticResource TransparentIconButton}"
                            ToolTip="{Binding SwitchModeToolTip}"
                            Margin="0,0,2,0" 
                            Click="SwitchModeButton_Click">
                        <materialIcons:MaterialIcon Kind="{Binding IsWadMode, Converter={StaticResource BooleanToMaterialIconConverter}, ConverterParameter='FolderOutline,ArchiveOutline'}" Width="18" Height="18"/>
                    </Button>

                    <ToggleButton x:Name="GridViewToggleButton" 
                                  Style="{StaticResource TransparentIconToggleButton}"
                                  ToolTip="Toggle Grid View"
                                  Margin="0,0,2,0" 
                                  IsChecked="{Binding IsGridMode}"
                                  Click="GridViewToggle_Click">
                        <materialIcons:MaterialIcon Kind="ViewGridOutline" Width="18" Height="18"/>
                    </ToggleButton>

                    <ToggleButton x:Name="BreadcrumbToggleButton"
                                  Style="{StaticResource TransparentIconToggleButton}"
                                  ToolTip="Show Breadcrumb"
                                  Margin="0,0,2,0"
                                  IsChecked="{Binding IsBreadcrumbVisible}"
                                  Click="BreadcrumbToggleButton_Click">
                        <materialIcons:MaterialIcon Kind="CodeTags" Width="18" Height="18"/>
                    </ToggleButton>

                    <ToggleButton x:Name="FavoritesToggleButton"
                                  Style="{StaticResource TransparentIconToggleButton}"
                                  Click="FavoritesToggleButton_Click"
                                  ToolTip="Toggle Favorites"
                                  Margin="0,0,2,0"
                                  IsChecked="{Binding IsFavoritesEnabled}"
                                  Visibility="{Binding DataContext.IsFavoritesToggleVisible, RelativeSource={RelativeSource AncestorType=UserControl}, Converter={StaticResource BoolToVisibilityConverter}}">
                        <materialIcons:MaterialIcon Kind="{Binding IsFavoritesEnabled, Converter={StaticResource BooleanToMaterialIconConverter}, ConverterParameter='Star,StarOutline'}" Width="18" Height="18"/>
                    </ToggleButton>

                    <Button x:Name="ImageMergerButton" 
                            Style="{StaticResource TransparentIconButton}" 
                            ToolTip="Open Image Merger" 
                            Margin="0,0,2,0" 
                            Click="ImageMergerButton_Click">
                        <materialIcons:MaterialIcon Kind="ViewGridPlus" Width="18" Height="18"/>
                    </Button>

                    <Rectangle Width="1" Height="16" Fill="{StaticResource BorderColor}" Margin="4,0,4,0" VerticalAlignment="Center"/>
                </StackPanel>

                <!-- Search Group (Animated via Style) -->
                <Grid x:Name="SearchGroup">
                    <StackPanel Orientation="Horizontal">
                        <ToggleButton x:Name="SearchToggleButton" 
                                      Style="{StaticResource SearchToggleStyle}" 
                                      IsChecked="{Binding IsSearchVisible}"
                                      Click="SearchToggleButton_Click"
                                      ToolTip="Toggle Search"
                                      Margin="0,0,0,0"/>

                        <Grid VerticalAlignment="Center" Margin="2,0,0,0">
                            <TextBox x:Name="SearchTextBox" 
                                     Style="{StaticResource AnimatedSearchBoxStyle}" 
                                     Tag="{Binding IsChecked, ElementName=SearchToggleButton}"
                                     Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                                     TextChanged="SearchTextBox_TextChanged"
                                     Margin="4,0,0,0"/>
                            
                            <StackPanel Orientation="Horizontal"
                                        IsHitTestVisible="False"
                                        VerticalAlignment="Center"
                                        HorizontalAlignment="Left"
                                        Margin="20,0,0,0">
                                <StackPanel.Style>
                                    <Style TargetType="StackPanel">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                        <Style.Triggers>
                                            <MultiDataTrigger>
                                                <MultiDataTrigger.Conditions>
                                                    <Condition Binding="{Binding Text, ElementName=SearchTextBox}" Value=""/>
                                                    <Condition Binding="{Binding IsChecked, ElementName=SearchToggleButton}" Value="True"/>
                                                </MultiDataTrigger.Conditions>
                                                <Setter Property="Visibility" Value="Visible"/>
                                            </MultiDataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </StackPanel.Style>
                                <materialIcons:MaterialIcon Kind="Magnify" Width="14" Height="14" Foreground="{StaticResource TextSecondary}" Opacity="0.5" Margin="0,0,5,0" VerticalAlignment="Center"/>
                                <TextBlock Text="Search..."
                                           Foreground="{StaticResource TextSecondary}"
                                           Opacity="0.5"
                                           FontSize="12"
                                           VerticalAlignment="Center"/>
                            </StackPanel>
                        </Grid>
                    </StackPanel>
                </Grid>
            </StackPanel>
        </Border>
    </Grid>
</UserControl>
