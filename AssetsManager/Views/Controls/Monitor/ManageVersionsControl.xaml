<UserControl x:Class="AssetsManager.Views.Controls.Monitor.ManageVersionsControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:AssetsManager.Views.Controls.Monitor"
             xmlns:materialIcons="clr-namespace:Material.Icons.WPF;assembly=Material.Icons.WPF"
             mc:Ignorable="d" 
             d:DesignHeight="1000" d:DesignWidth="800">

    <Grid Margin="0,10,0,0">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/> <!-- Header -->
            <RowDefinition Height="Auto"/> <!-- Toolbar -->
            <RowDefinition Height="Auto"/> <!-- Tab Selector -->
            <RowDefinition Height="*"/>    <!-- Content Area -->
        </Grid.RowDefinitions>

        <!-- 1. HEADER -->
        <Border Grid.Row="0" Margin="0,0,0,20" Background="{DynamicResource CardBackground}" CornerRadius="12" Padding="24,20" BorderBrush="{DynamicResource BorderColor}" BorderThickness="1">
            <Grid>
                <Grid.ColumnDefinitions><ColumnDefinition Width="Auto"/><ColumnDefinition Width="*"/></Grid.ColumnDefinitions>
                <Border Grid.Column="0" Background="{DynamicResource HoverColor}" CornerRadius="10" Width="50" Height="50" Margin="0,0,20,0"><materialIcons:MaterialIcon Kind="CloudDownloadOutline" Width="26" Height="26" Foreground="{DynamicResource AccentBrush}"/></Border>
                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                    <TextBlock Text="Manage Versions" FontSize="22" FontWeight="Bold" Foreground="{DynamicResource TextPrimary}"/>
                    <TextBlock Text="Download and organize League of Legends manifests and clients" FontSize="12" Foreground="{DynamicResource TextSecondary}" Margin="0,2,0,0"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- 2. TOOLBAR -->
        <Border Grid.Row="1" Margin="0,0,0,16" Background="{DynamicResource SidebarBackground}" CornerRadius="8" Padding="16,12" BorderBrush="{DynamicResource BorderColor}" BorderThickness="1">
            <StackPanel>
                <Grid Margin="0,0,0,12">
                    <Grid.ColumnDefinitions><ColumnDefinition Width="Auto"/><ColumnDefinition Width="*"/><ColumnDefinition Width="Auto"/></Grid.ColumnDefinitions>
                    <StackPanel Orientation="Horizontal">
                        <Button Content="Fetch All" Click="FetchVersions_Click" Style="{DynamicResource ModernButton}" Margin="0,0,8,0"/>
                        <Button Content="Get League Client" Click="GetLeagueClient_Click" Style="{DynamicResource SecondaryButton}" Margin="0,0,8,0"/>
                        <Button Content="Get Game Client" Click="GetLoLGameClient_Click" Style="{DynamicResource SecondaryButton}"/>
                    </StackPanel>
                    <Button Grid.Column="2" Click="DeleteSelectedVersions_Click" Style="{DynamicResource TransparentIconButton}" Width="32" Height="32" ToolTip="Delete Selected"><materialIcons:MaterialIcon Kind="TrashCanOutline" Width="18" Foreground="{DynamicResource AccentRed}"/></Button>
                </Grid>
                <Border Background="{DynamicResource CardBackground}" CornerRadius="6" Padding="12,8" BorderBrush="{DynamicResource BorderColor}" BorderThickness="1">
                    <StackPanel Orientation="Horizontal">
                        <materialIcons:MaterialIcon Kind="Translate" Foreground="{DynamicResource AccentOrange}" Width="14" Margin="0,0,12,0" VerticalAlignment="Center"/>
                        <TextBlock Text="Download Locales:" FontSize="11" FontWeight="SemiBold" Foreground="{DynamicResource TextSecondary}" VerticalAlignment="Center" Margin="0,0,16,0"/>
                        <ItemsControl ItemsSource="{Binding AvailableLocales}"><ItemsControl.ItemsPanel><ItemsPanelTemplate><StackPanel Orientation="Horizontal"/></ItemsPanelTemplate></ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate><DataTemplate><CheckBox Content="{Binding Code}" IsChecked="{Binding IsSelected}" Style="{DynamicResource ModernCheckBox}" Margin="0,0,16,0" FontSize="11"/></DataTemplate></ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                </Border>
            </StackPanel>
        </Border>

        <!-- 3. TAB SELECTOR -->
        <Border Grid.Row="2" Margin="0,0,0,2" Background="{DynamicResource SidebarBackground}" CornerRadius="8" Padding="4" BorderBrush="{DynamicResource BorderColor}" BorderThickness="1" HorizontalAlignment="Left">
            <StackPanel Orientation="Horizontal">
                <RadioButton x:Name="TabClient" Content="League Client" IsChecked="True" GroupName="VersionTabs" Style="{DynamicResource SegmentedRadioButtonStyle}" Width="140"/>
                <RadioButton x:Name="TabGame" Content="Game Client" GroupName="VersionTabs" Style="{DynamicResource SegmentedRadioButtonStyle}" Width="140"/>
            </StackPanel>
        </Border>

        <!-- 4. CONTENT AREA -->
        <Grid Grid.Row="3">
            <!-- LEAGUE CLIENT LIST -->
            <Grid x:Name="ClientPanel">
                <Grid.Style><Style TargetType="Grid"><Setter Property="Visibility" Value="Collapsed"/><Style.Triggers><DataTrigger Binding="{Binding IsChecked, ElementName=TabClient}" Value="True"><Setter Property="Visibility" Value="Visible"/></DataTrigger></Style.Triggers></Style></Grid.Style>
                <Grid.RowDefinitions><RowDefinition Height="Auto"/><RowDefinition Height="*"/></Grid.RowDefinitions>
                <StackPanel Grid.Row="0" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,0,0,8">
                    <StackPanel.Style><Style TargetType="StackPanel"><Style.Triggers><DataTrigger Binding="{Binding LeagueClientPaginator.TotalPages}" Value="0"><Setter Property="Visibility" Value="Collapsed"/></DataTrigger></Style.Triggers></Style></StackPanel.Style>
                    <Button Style="{DynamicResource TransparentIconButton}" Click="PrevLeagueClientPage_Click" IsEnabled="{Binding LeagueClientPaginator.CanGoToPreviousPage}" Width="24" Height="24"><materialIcons:MaterialIcon Kind="ChevronLeft" Width="18" Foreground="{DynamicResource TextSecondary}"/></Button>
                    <TextBlock Text="{Binding LeagueClientPaginator.PageInfo}" Foreground="{DynamicResource TextSecondary}" FontSize="12" VerticalAlignment="Center" Margin="12,0"/>
                    <Button Style="{DynamicResource TransparentIconButton}" Click="NextLeagueClientPage_Click" IsEnabled="{Binding LeagueClientPaginator.CanGoToNextPage}" Width="24" Height="24"><materialIcons:MaterialIcon Kind="ChevronRight" Width="18" Foreground="{DynamicResource TextSecondary}"/></Button>
                </StackPanel>

                <ListView Grid.Row="1" x:Name="LeagueClientVersionsListView" ItemsSource="{Binding LeagueClientPaginator.PagedItems}" Style="{DynamicResource ModernListView}" Background="Transparent" BorderThickness="0">
                    <ListView.ItemContainerStyle>
                        <Style TargetType="ListViewItem">
                            <Setter Property="HorizontalContentAlignment" Value="Stretch"/><Setter Property="Background" Value="Transparent"/><Setter Property="Margin" Value="0,0,0,8"/>
                            <!-- BINDING CRÃTICO: Conecta la UI con el modelo IsSelected -->
                            <Setter Property="IsSelected" Value="{Binding IsSelected, Mode=TwoWay}"/>
                            <EventSetter Event="PreviewMouseDown" Handler="ListViewItem_PreviewMouseDown"/>
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="ListViewItem">
                                        <Border x:Name="SelectionBorder" Background="{DynamicResource CardBackground}" CornerRadius="10" Padding="16,12" BorderBrush="{DynamicResource BorderColor}" BorderThickness="1">
                                            <Grid>
                                                <Grid.ColumnDefinitions><ColumnDefinition Width="Auto"/><ColumnDefinition Width="*"/><ColumnDefinition Width="Auto"/></Grid.ColumnDefinitions>
                                                <Border Grid.Column="0" Width="40" Height="40" CornerRadius="8" Background="{DynamicResource HoverColor}" Margin="0,0,16,0"><materialIcons:MaterialIcon Kind="DesktopClassic" Width="20" Foreground="{DynamicResource AccentBlue}" HorizontalAlignment="Center" VerticalAlignment="Center"/></Border>
                                                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                                    <TextBlock Text="{Binding FileName}" FontWeight="Bold" FontSize="14" Foreground="{DynamicResource TextPrimary}"/>
                                                    <TextBlock Text="{Binding Date, StringFormat='Published on {0}'}" FontSize="11" Foreground="{DynamicResource TextMuted}" Margin="0,2,0,0"/>
                                                </StackPanel>
                                                <materialIcons:MaterialIcon x:Name="CheckIcon" Grid.Column="2" Kind="CheckCircle" Foreground="{DynamicResource AccentBrush}" Width="20" Visibility="Collapsed"/>
                                            </Grid>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsSelected" Value="True">
                                                <Setter TargetName="SelectionBorder" Property="BorderBrush" Value="{DynamicResource AccentBrush}"/>
                                                <Setter TargetName="SelectionBorder" Property="BorderThickness" Value="2"/>
                                                <Setter TargetName="SelectionBorder" Property="Background" Value="{DynamicResource HoverColor}"/>
                                                <Setter TargetName="CheckIcon" Property="Visibility" Value="Visible"/>
                                            </Trigger>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter TargetName="SelectionBorder" Property="Background" Value="{DynamicResource HoverColor}"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </ListView.ItemContainerStyle>
                </ListView>
            </Grid>

            <!-- GAME CLIENT LIST -->
            <Grid x:Name="GamePanel">
                <Grid.Style><Style TargetType="Grid"><Setter Property="Visibility" Value="Collapsed"/><Style.Triggers><DataTrigger Binding="{Binding IsChecked, ElementName=TabGame}" Value="True"><Setter Property="Visibility" Value="Visible"/></DataTrigger></Style.Triggers></Style></Grid.Style>
                <Grid.RowDefinitions><RowDefinition Height="Auto"/><RowDefinition Height="*"/></Grid.RowDefinitions>
                <StackPanel Grid.Row="0" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,0,0,8">
                    <StackPanel.Style><Style TargetType="StackPanel"><Style.Triggers><DataTrigger Binding="{Binding LoLGameClientPaginator.TotalPages}" Value="0"><Setter Property="Visibility" Value="Collapsed"/></DataTrigger></Style.Triggers></Style></StackPanel.Style>
                    <Button Style="{DynamicResource TransparentIconButton}" Click="PrevLoLGameClientPage_Click" IsEnabled="{Binding LoLGameClientPaginator.CanGoToPreviousPage}" Width="24" Height="24"><materialIcons:MaterialIcon Kind="ChevronLeft" Width="18" Foreground="{DynamicResource TextSecondary}"/></Button>
                    <TextBlock Text="{Binding LoLGameClientPaginator.PageInfo}" Foreground="{DynamicResource TextSecondary}" FontSize="12" VerticalAlignment="Center" Margin="12,0"/>
                    <Button Style="{DynamicResource TransparentIconButton}" Click="NextLoLGameClientPage_Click" IsEnabled="{Binding LoLGameClientPaginator.CanGoToNextPage}" Width="24" Height="24"><materialIcons:MaterialIcon Kind="ChevronRight" Width="18" Foreground="{DynamicResource TextSecondary}"/></Button>
                </StackPanel>

                <ListView Grid.Row="1" x:Name="LoLGameClientVersionsListView" ItemsSource="{Binding LoLGameClientPaginator.PagedItems}" Style="{DynamicResource ModernListView}" Background="Transparent" BorderThickness="0">
                    <ListView.ItemContainerStyle>
                        <Style TargetType="ListViewItem">
                            <Setter Property="HorizontalContentAlignment" Value="Stretch"/><Setter Property="Background" Value="Transparent"/><Setter Property="Margin" Value="0,0,0,8"/>
                            <Setter Property="IsSelected" Value="{Binding IsSelected, Mode=TwoWay}"/>
                            <EventSetter Event="PreviewMouseDown" Handler="ListViewItem_PreviewMouseDown"/>
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="ListViewItem">
                                        <Border x:Name="SelectionBorder" Background="{DynamicResource CardBackground}" CornerRadius="10" Padding="16,12" BorderBrush="{DynamicResource BorderColor}" BorderThickness="1">
                                            <Grid>
                                                <Grid.ColumnDefinitions><ColumnDefinition Width="Auto"/><ColumnDefinition Width="*"/><ColumnDefinition Width="Auto"/></Grid.ColumnDefinitions>
                                                <Border Grid.Column="0" Width="40" Height="40" CornerRadius="8" Background="{DynamicResource HoverColor}" Margin="0,0,16,0"><materialIcons:MaterialIcon Kind="GamepadVariantOutline" Width="20" Foreground="{DynamicResource AccentGreen}" HorizontalAlignment="Center" VerticalAlignment="Center"/></Border>
                                                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                                    <TextBlock Text="{Binding FileName}" FontWeight="Bold" FontSize="14" Foreground="{DynamicResource TextPrimary}"/>
                                                    <TextBlock Text="{Binding Date, StringFormat='Published on {0}'}" FontSize="11" Foreground="{DynamicResource TextMuted}" Margin="0,2,0,0"/>
                                                </StackPanel>
                                                <materialIcons:MaterialIcon x:Name="CheckIcon" Grid.Column="2" Kind="CheckCircle" Foreground="{DynamicResource AccentBrush}" Width="20" Visibility="Collapsed"/>
                                            </Grid>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsSelected" Value="True">
                                                <Setter TargetName="SelectionBorder" Property="BorderBrush" Value="{DynamicResource AccentBrush}"/>
                                                <Setter TargetName="SelectionBorder" Property="BorderThickness" Value="2"/>
                                                <Setter TargetName="SelectionBorder" Property="Background" Value="{DynamicResource HoverColor}"/>
                                                <Setter TargetName="CheckIcon" Property="Visibility" Value="Visible"/>
                                            </Trigger>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter TargetName="SelectionBorder" Property="Background" Value="{DynamicResource HoverColor}"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </ListView.ItemContainerStyle>
                </ListView>
            </Grid>
        </Grid>
    </Grid>
</UserControl>