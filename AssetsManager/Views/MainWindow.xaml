<mah:MetroWindow x:Class="AssetsManager.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:mah="http://metro.mahapps.com/winfx/xaml/controls"
        xmlns:local="clr-namespace:AssetsManager.Views"
        xmlns:controls="clr-namespace:AssetsManager.Views.Controls"
        xmlns:dialogControls="clr-namespace:AssetsManager.Views.Dialogs.Controls"
        xmlns:icons="clr-namespace:Material.Icons.WPF;assembly=Material.Icons.WPF"
        xmlns:tb="http://www.hardcodet.net/taskbar"
        mc:Ignorable="d"
        Title="AssetsManager"
        Width="1100" Height="900"
        MinWidth="1100" MinHeight="900"
        WindowStartupLocation="CenterScreen"
        Background="Transparent"
        AllowsTransparency="True"
        WindowStyle="None"
        IgnoreTaskbarOnMaximize="False"
        FontFamily="{StaticResource AppFontFamily}"
        ShowTitleBar="False"
        IsWindowDraggable="True"
        GlowBrush="{x:Null}"
        BorderThickness="0"
        ResizeMode="CanResize"
        WindowTransitionsEnabled="False">

    <WindowChrome.WindowChrome>
        <WindowChrome CaptionHeight="0" 
                      ResizeBorderThickness="5" 
                      GlassFrameThickness="0" 
                      CornerRadius="0" />
    </WindowChrome.WindowChrome>

    <mah:MetroWindow.WindowButtonCommands>
        <mah:WindowButtonCommands Visibility="Collapsed" />
    </mah:MetroWindow.WindowButtonCommands>

    <!-- MAIN WRAPPER WITH ROUNDED CORNERS -->
    <Border x:Name="MainWindowBorder" 
            Background="{StaticResource SidebarBackground}" 
            BorderBrush="{StaticResource BorderColor}" 
            BorderThickness="1" 
            CornerRadius="11"
            ClipToBounds="True">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/> <!-- 0: Custom Title Bar -->
                <RowDefinition Height="*"/>    <!-- 1: Main Content -->
            </Grid.RowDefinitions>

            <!-- 1. Custom Title Bar (HUD Design) -->
            <Border Grid.Row="0" Background="{StaticResource CardBackground}" Height="40" 
                    MouseLeftButtonDown="TitleBar_MouseDown"
                    BorderBrush="{StaticResource BorderColor}" BorderThickness="0,0,0,1" 
                    CornerRadius="11,11,0,0"
                    Panel.ZIndex="10">
                <Border.Effect>
                    <DropShadowEffect BlurRadius="8" ShadowDepth="1" Color="Black" Opacity="0.15" Direction="270"/>
                </Border.Effect>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/> <!-- App Icon -->
                        <ColumnDefinition Width="Auto"/> <!-- Title -->
                        <ColumnDefinition Width="*"/>    <!-- Drag Area -->
                        <ColumnDefinition Width="Auto"/> <!-- Window Controls -->
                    </Grid.ColumnDefinitions>

                    <Image Grid.Column="0" Source="pack://application:,,,/AssetsManager;component/Resources/Img/logo.ico" Width="18" Height="18" Margin="15,0,0,0" VerticalAlignment="Center"/>
                    <TextBlock Grid.Column="1" Text="AssetsManager" FontSize="13" FontWeight="Normal" Foreground="{StaticResource TextPrimary}" VerticalAlignment="Center" Margin="10,0,0,0"/>

                    <StackPanel Grid.Column="3" Orientation="Horizontal">
                        <Button Style="{StaticResource TitleBarButtonStyle}" Click="Minimize_Click" Width="34" Height="40">
                            <icons:MaterialIcon Kind="WindowMinimize" Width="15" Height="15"/>
                        </Button>
                        <Button Style="{StaticResource TitleBarButtonStyle}" Click="Maximize_Click" Width="34" Height="40">
                            <icons:MaterialIcon Kind="WindowMaximize" Width="15" Height="15"/>
                        </Button>
                        <Button Style="{StaticResource TitleBarButtonStyle}" Click="Close_Click" Width="34" Height="40" Margin="0,0,2,0">
                            <icons:MaterialIcon Kind="WindowClose" Width="15" Height="15"/>
                        </Button>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Main Layout Content -->
            <Grid Grid.Row="1">
                <tb:TaskbarIcon x:Name="TrayIcon" Visibility="Collapsed" ToolTipText="AssetsManager" IconSource="pack://application:,,,/AssetsManager;component/Resources/Img/logo.ico" TrayMouseDoubleClick="TrayIcon_TrayMouseDoubleClick">
                    <tb:TaskbarIcon.ContextMenu>
                        <ContextMenu>
                            <MenuItem Header="Show" Click="MenuItem_Show_Click"><MenuItem.Icon><icons:MaterialIcon Kind="Eye"/></MenuItem.Icon></MenuItem>
                            <MenuItem Header="Exit" Click="MenuItem_Exit_Click"><MenuItem.Icon><icons:MaterialIcon Kind="Power"/></MenuItem.Icon></MenuItem>
                        </ContextMenu>
                    </tb:TaskbarIcon.ContextMenu>
                </tb:TaskbarIcon>

                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition x:Name="SidebarColumn" Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Sidebar - Rounded bottom-left -->
                    <Border Grid.Column="0" Background="{StaticResource SidebarBackground}" CornerRadius="0,0,0,11" ClipToBounds="True">
                        <controls:SidebarView x:Name="Sidebar"/>
                    </Border>

                    <!-- Content Area, Logger and Status Bar -->
                    <Grid Grid.Column="1">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/> <!-- GridSplitter -->
                            <RowDefinition x:Name="LogRowDefinition" Height="180" MinHeight="38"/>
                            <RowDefinition Height="Auto"/> <!-- StatusBar -->
                        </Grid.RowDefinitions>
                        
                        <Border Grid.Row="0" Background="Transparent" BorderBrush="{StaticResource BorderColor}" BorderThickness="0,0,0,1">
                            <ContentControl x:Name="MainContentArea" Background="Transparent"/>
                        </Border>

                        <!-- GLINDER (GRID SPLITTER) - ORIGINAL CODE RESTORED -->
                        <GridSplitter Grid.Row="1"
                                      Height="8" HorizontalAlignment="Stretch"
                                      VerticalAlignment="Center"
                                      Background="Transparent"
                                      Cursor="SizeNS"
                                      ResizeDirection="Rows"
                                      ResizeBehavior="PreviousAndNext"
                                      ShowsPreview="False">
                            <GridSplitter.Template>
                                <ControlTemplate TargetType="GridSplitter">
                                    <Border Background="Transparent" x:Name="RootBorder">
                                        <Border x:Name="Handle" 
                                                Width="36" Height="4" 
                                                Background="{StaticResource BorderColor}" 
                                                CornerRadius="2" 
                                                VerticalAlignment="Center" 
                                                HorizontalAlignment="Center"
                                                Opacity="0.6"/>
                                    </Border>
                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter TargetName="Handle" Property="Background" Value="{StaticResource AccentBrush}"/>
                                            <Setter TargetName="Handle" Property="Opacity" Value="1"/>
                                            <Setter TargetName="Handle" Property="Width" Value="48"/>
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </GridSplitter.Template>
                        </GridSplitter>

                        <!-- LogView - Rounded bottom-right -->
                        <Border Grid.Row="2" Background="{StaticResource SidebarBackground}" BorderBrush="{StaticResource BorderColor}" BorderThickness="0,1,0,0" CornerRadius="0,0,11,0" ClipToBounds="True">
                            <controls:LogView x:Name="LogView" StatusText="{Binding ViewModel.StatusText, ElementName=StatusBar}"/>
                        </Border>
                        
                        <!-- StatusBar - Rounded bottom-right -->
                        <Border Grid.Row="3" Background="{StaticResource SidebarBackground}" CornerRadius="0,0,11,0" ClipToBounds="True">
                            <controls:StatusBarView x:Name="StatusBar"/>
                        </Border>
                    </Grid>
                </Grid>
            </Grid>
        </Grid>
    </Border>
</mah:MetroWindow>